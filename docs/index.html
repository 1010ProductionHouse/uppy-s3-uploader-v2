<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>File Uploader</title>
  
  <link href="https://releases.transloadit.com/uppy/v2.10.0/uppy.min.css" rel="stylesheet">
</head>
<body>

  <h1>Upload Your Files</h1>
  
  <div id="drag-drop-area"></div>

  <script src="https://releases.transloadit.com/uppy/v2.10.0/uppy.min.js"></script>

  <script>
    // Replace this with a dynamic value from your authentication process
    const MEMBER_ID = 'your-member-id-here'; 
    const API_GATEWAY_URL = 'https://wituigrjpl.execute-api.us-west-2.amazonaws.com/prod/Nexudus-EC2-Gatekeeper';

    const { Uppy, DragDrop, AwsS3 } = Uppy;

    const uppy = new Uppy({
      restrictions: {
        maxNumberOfFiles: 1, // Only one file can be uploaded at a time
        maxFileSize: 100 * 1024 * 1024 // 100MB in bytes
      }
    });

    uppy.use(DragDrop, {
      target: '#drag-drop-area'
    });

    uppy.use(AwsS3, {
      get=Google_search(queries=['Uppy S3 getUploadParameters example']), (queries=['Uppy S3 getUploadParameters example']), (queries=['Uppy S3 getUploadParameters example']), (queries=['Uppy S3 getUploadParameters example'])
      getUploadParameters(file) {
        // Send a request to your Lambda API to get the pre-signed S3 URL
        return fetch(API_GATEWAY_URL, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            // RECOMMENDED: Pass the member ID in a custom header
            'X-Uploader-ID': MEMBER_ID
          },
          body: JSON.stringify({
            filename: file.name,
            filetype: file.type
          })
        }).then(response => {
          if (!response.ok) {
            throw new Error(`Server returned a ${response.status} status code`);
          }
          return response.json();
        }).then(data => {
          // The data received from Lambda should contain the pre-signed S3 URL and other required fields.
          // Your Lambda's response body: {"url": "...", "key": "..."}
          return {
            method: 'PUT',
            url: data.url,
            // The file's key is included in the URL, so we don't need a `fields` object
            fields: {}, 
            headers: {
              'Content-Type': file.type
            }
          };
        });
      }
    });

    // Log success events to the console
    uppy.on('complete', (result) => {
      console.log('Upload complete! Weâ€™ve uploaded these files:', result.successful);
    });

    // Log errors for debugging
    uppy.on('file-added', (file) => {
      console.log('File added:', file.name);
    });

    uppy.on('error', (error) => {
      console.error('Uppy error:', error);
    });
  </script>

</body>
</html>
